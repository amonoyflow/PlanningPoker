resources:
  repositories:
    - repository: templates
      type: github
      name: amonoyflow/xamarin-pipeline-templates
      endpoint: github_service_connection

pool:
  vmImage: 'macos-latest'

variables:
  - group: android-pipeline

stages:
    - stage: Build
      displayName: Build stage
      variables:
        deploy: $(deploy)
      jobs:
          - template: xamarin-android-build.yml@templates
            parameters:
                projectName: 'planningpoker'
                buildConfiguration: '$(buildConfiguration)'
                outputDirectory: '$(outputDirectory)'
                keystoreFile: 'planningpoker.keystore'
                keystorePassword: $(keystore.password)
                keystoreAlias: $(keystore.alias)
                keyPassword: $(key.password)
                netCoreVersion: '3.0.x'
                nugetVersion: '5.3.1'
                version: '$(majorVersion).$(minorVersion).$(Build.BuildId)'

    - stage: Distribute
      displayName: Distribute stage
      condition: and(succeeded(), eq(variables['deploy'], 'true'))
      jobs:
        - template: xamarin-android-distribute.yml@templates
          parameters:
            projectName: planningpoker
            outputDirectory: '$(outputDirectory)'
            appSlug: '$(appSlug)'